# Gemini 3 Proは「編集履歴」を覚えている - Lumina開発メモ 🎨

こんにちは、あおいです！

AI画像生成アプリ「Lumina」の開発中に、Gemini 3 Proならではの特徴を発見したので共有します。

## 起きたこと

Gemini 3 Proで画像を作って再編集しようとしたら、`400 INVALID_ARGUMENT`というエラーが出ました。

400エラーということは、**クライアント側（私たちのアプリ側）の問題**です。503のようなサーバー側のエラーではありません。

## Gemini 3 Proの特徴・モデルごとの違い

実装を調べてみると、Gemini 3 Proには**編集履歴データが必要**という仕様があることがわかりました。

**Gemini 3 Pro**：画像生成時に編集履歴データを返してきます。次の編集時、この履歴を送り返すことで「前回の続き」として処理できます。これは**Gemini 3 Pro独自の特徴**です。

**Gemini 2.5 Flash / Imagen 4**：編集履歴は持ちません。毎回新規の画像として扱います。

私たちのアプリは画像データだけを保存していて、編集履歴を捨てていました。そのため、Gemini 3 Proで再編集時に「履歴がない！」とエラーになっていたんです。

## 解決策

APIから返ってくる**全データを保存**することにしました。編集履歴も含めて全部保存しておいて、実際に使うかどうかは各モデルが判断します。

古い画像やImagen 4で作った画像には履歴がないので、これらは「新規画像」として扱うフォールバック処理も追加しました。

## 学んだこと

APIが返すデータは全部意味があります。「画像だけあればいい」と思わず、見えないデータも保存することが大切でした。また、400エラー（クライアント側）と503エラー（サーバー側）の違いを意識すること、モデルごとの仕様の違いを理解することの重要性を実感しました。

---

#個人開発 #AI #GeminiAPI
